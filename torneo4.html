<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nicolino SV</title>
  <!-- MDB icon -->
  <link rel="icon" href="img/cs.ico" type="image/x-icon">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
  <!-- Google Fonts Roboto -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Material Design Bootstrap -->
  <link rel="stylesheet" href="css/mdb.min.css">
  <!-- Your custom styles (optional) -->
  <link rel="stylesheet" href="css/style.css">
  <!-- MDBootstrap Datatables  -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.20/fh-3.1.6/datatables.min.css">
</head>

<body class="white-text" style="background-color: #272A33;">

  <!-- Start your project here-->
  
  <!-- NAVBAR-->
  <nav style="background-color: #24262F;" class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand" href="index.html"><img src="img/cs.ico" height="30" alt="cs logo"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Ranking</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.dropbox.com/sh/8cwcsq72dozq259/AACZDObJiDxYmbRrA-7Z5MnDa?dl=0" target="_blank">Mapas</a>
        </li>

        <!-- Dropdown -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Torneos</a>
          <div class="dropdown-menu dropdown-primary" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="torneo1.html">Torneo 1</a>
            <a class="dropdown-item" href="torneo2.html">Torneo 2</a>
            <a class="dropdown-item" href="torneo3.html">Torneo 3</a>
            <a class="dropdown-item" href="torneo4.html">Torneo 4</a>
          </div>
        </li>
        
      </ul>
      <ul class="navbar-nav ml-auto nav-flex-icons">
        <li class="nav-item">
          <a class="nav-link waves-effect waves-light" href="https://www.youtube.com/c/masitatv" target="_blank">
            <i class="fab fa-youtube"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link waves-effect waves-light" href="https://www.instagram.com/nicolinosv" target="_blank">
            <i class="fab fa-instagram"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link waves-effect waves-light" href="https://github.com/Syuks/NicolinoSV" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <h1 style="text-align:center; margin:20px">NicolinoSV - Torneo 4</h1>

  <iframe src="https://challonge.com/NicolinoSv4/module" width="100%" height="500px" frameborder="0" scrolling="no" allowtransparency="true"></iframe>

  <h2 style="text-align:center; margin-top:20px">Estad√≠sticas</h2>

  <div class="container row">

    <!-- Dropdown 1 -->
    <div>
      <button class="btn btn-primary dropdown-toggle mr-3" type="button" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false">Ronda Incial</button>

      <div class="dropdown-menu">
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida1.json", "Partida1")' class="dropdown-item">SicAri@s-KILLopr4x1a</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida2.json", "Partida2")' class="dropdown-item">TheClutchmen-TARGAYEN</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida3.json", "Partida3")' class="dropdown-item">TheClutchmen-WarningSystem</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida4.json", "Partida4")' class="dropdown-item">KILLopr4x1a-TheClutchmen</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida5.json", "Partida5")' class="dropdown-item">TARGAYEN-WarningSystem</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida6.json", "Partida6")' class="dropdown-item">SicAri@s-TARGAYEN</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida7.json", "Partida7")' class="dropdown-item">WarningSystem-SicAri@s</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida8.json", "Partida8")' class="dropdown-item">WarningSystem-KILLopr4x1a</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida9.json", "Partida9")' class="dropdown-item">KILLopr4x1a-TARGAYEN</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-partida10.json", "Partida10")' class="dropdown-item">SicAri@s-TheClutchmen</button>
        <div class="dropdown-divider"></div>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-rondaInicial.json", "Empty")' class="dropdown-item">Totales</button>
      </div>
    </div>
    
    <!-- Dropdown 2 -->
    <div>
      <button class="btn btn-primary dropdown-toggle mr-3" type="button" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false">Play Offs</button>

      <div class="dropdown-menu">
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-semifinal1.json", "Losers1")' class="dropdown-item">Semifinal-1</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-semifinal2.json", "Winners1")' class="dropdown-item">Semifinal-2</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-3erpuesto.json", "Losers2")' class="dropdown-item">Losers</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-final.json", "Final")' class="dropdown-item">Final</button>
        <div class="dropdown-divider"></div>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-playoffs.json", "Empty")' class="dropdown-item">Totales</button>
      </div>
    </div>

    <!-- Dropdown 3 -->
    <div>
      <button class="btn btn-primary dropdown-toggle mr-3" type="button" data-toggle="dropdown"
      aria-haspopup="true" aria-expanded="false">Totales</button>

      <div class="dropdown-menu">
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-rondaInicial.json", "Empty")' class="dropdown-item">Ronda Inicial</button>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-playoffs.json", "Empty")' class="dropdown-item">PlayOffs</button>
        <div class="dropdown-divider"></div>
        <button onclick='fetchJsonData("torneoData/torneo4/torneoData-totales.json", "Empty")' class="dropdown-item">Totales Torneo</button>
      </div>
    </div>
    
    <a class="btn btn-primary" href="#" id="demoButton"><i class="fas fa-download"></i> Demo</a>

  </div>

    <table id="myTable" class="table-sm table-hover table-dark text-nowrap" width=100%>
        <thead style="background-color:#222732; text-align:center;">
        <tr>
            <th></th>
            <th style="text-align:left;">Nombre</th>
            <th>Kills</th>
            <th>Deaths</th>
            <th>K/D</th>
            <th>Damage</th>      
            <th>Disparos</th>
            <th>Aciertos</th>
            <th>Accuracy</th>
            <th>Headshots</th>
            <th>Hs/Aciertos</th>
            <th>TeamKills</th>
            <th>Defused</th>
            <th>C4</th>
        </tr>
        </thead>
        <tbody style="background-color: #272A33;"></tbody>
    </table>
 

  <!-- End your project here-->

  <!-- jQuery -->
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="js/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <!-- Datatables and Fixed Table Header  -->
  <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.20/fh-3.1.6/datatables.min.js"></script>
  
  <script>
    var t;

    var demos = {
      Partida1: "https://www.dl.dropboxusercontent.com/s/3z2h047l9tjvyl1/partida1-de_tuscan.zip?dl=0",
      Partida2: "https://www.dl.dropboxusercontent.com/s/qflhstudwxphmjf/partida2-de_cbble.zip?dl=0",
      Partida3: "https://www.dl.dropboxusercontent.com/s/30wud8f1ok0zi0c/partida3-de_tuscan.zip?dl=0",
      Partida4: "https://www.dl.dropboxusercontent.com/s/s381x2y6aqsvn58/partida4-de_inferno.zip?dl=0",
      Partida5: "https://www.dl.dropboxusercontent.com/s/qh8stuawy4fknjy/partida5-de_dust2.zip?dl=0",
      Partida6: "https://www.dl.dropboxusercontent.com/s/chama449f79h274/partida6-de_inferno.zip?dl=0",
      Partida7: "https://www.dl.dropboxusercontent.com/s/e658ax8vc9hfub9/partida7-de_mirage.zip?dl=0",
      Partida8: "https://www.dl.dropboxusercontent.com/s/fjpfrnsygn9r04m/partida8-de_cbble.zip?dl=0",
      Partida9: "https://www.dl.dropboxusercontent.com/s/m89loiijspwojm6/partida9-de_mirage.zip?dl=0",
      Partida10: "https://www.dl.dropboxusercontent.com/s/p4ltkg3wnux6dr1/partida10-de_dust2.zip?dl=0",
      Losers1: "https://www.dl.dropboxusercontent.com/s/8mx01xbz8cb0wgk/losers1.zip?dl=0",
      Winners1: "https://www.dl.dropboxusercontent.com/s/9ltid5rtu0ny4l0/winners1.zip?dl=0",
      Losers2: "https://www.dl.dropboxusercontent.com/s/tmh6pm2qpeia5a1/losers2.zip?dl=0",
      Final: "https://www.dl.dropboxusercontent.com/s/hqo73rzu93ayg3v/final.zip?dl=0",
      Empty: "#"
    };

    //Initialize Datatable
    $(document).ready(function () {
        t = $('#myTable').DataTable({        
                  "iDisplayLength": 25,
                  "order": [[ 2, "desc" ]],
                  "pagingType": "simple_numbers",
                  "columnDefs": [
                    { "width": "7%", "targets": [2,3,4,5,6,7,8,9,10,11,12,13] }, //para que todos los datos tengan el mismo ancho
                    { "width": "2%", "targets": [0] },
                    { "targets": [0,1] , className: "leftAligned"}, //les doy un nombre de css a estar columnas para ponerlas sobre la izquierda
                    { "orderSequence": [ "desc", "asc" ], "targets": [2,3,4,5,6,7,8,9,10,11,12,13] }, //para que apenas apretes se ordene de mayor a menor
                    { "searchable": false, "orderable": false, "targets": 0 } //para que no busquen ni ordenen la columna del index
                  ],
                  fixedHeader: true,
                  //responsive: true
                });
        $('.dataTables_length').addClass('bs-select');

        //para que la columna del index siempre empiece del 1
        t.on( 'order.dt', function () {
          t.column(0, {order:'applied'}).nodes().each( function (cell, i) {
              cell.innerHTML = i+1;
          } );
      } ).draw();
      //fetchJsonData("torneoData-rondaInicial.json");
    });

        function fetchJsonData(partida, demo){

          document.getElementById("demoButton").href=demos[demo];
          
          //Get csstats data
          var xmlhttp = new XMLHttpRequest();
          var url = partida;
          
          xmlhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  var myArr = JSON.parse(this.responseText);
                  GetRepeatedPlayers(myArr);
              }
          };
          xmlhttp.open("GET", url, true);
          xmlhttp.send();
        }
  
        //Get repeated players data
        function GetRepeatedPlayers (csstats) {
          var xmlhttp2 = new XMLHttpRequest();
          var url = "torneoData/torneo4/tourneyrepeatedPlayers.json";
          
          xmlhttp2.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  var playerIndex = JSON.parse(this.responseText);
                  PopulateTable(csstats, playerIndex);
              }
          };
          xmlhttp2.open("GET", url, true);
          xmlhttp2.send();
        }
  
        //Data Handling
        function PopulateTable(arr, repeatedPlayersIndex) {
          
          t.clear();

          jsonIteration: //etiqueta para poder hacer continue directamente a este loop desde otro for loop interno
          for (i in arr){
            
            //check if i is one of the repeatedPlayers
            for (r in repeatedPlayersIndex) {
              for (u in repeatedPlayersIndex[r].uniques){
                if (arr[i].unique == repeatedPlayersIndex[r].uniques[u]){
                  repeatedPlayersIndex[r].kills += arr[i].kills;
                  repeatedPlayersIndex[r].deaths += arr[i].deaths;
                  repeatedPlayersIndex[r].dmg += arr[i].dmg;
                  repeatedPlayersIndex[r].shots += arr[i].shots;
                  repeatedPlayersIndex[r].hits += arr[i].hits;
                  repeatedPlayersIndex[r].hs += arr[i].hs;
                  repeatedPlayersIndex[r].tks += arr[i].tks;
                  repeatedPlayersIndex[r].bDefused += arr[i].bDefused;
                  repeatedPlayersIndex[r].bExplosions += arr[i].bExplosions;
                  continue jsonIteration;
                }
              }
            }
  
            //Si i no era uno de los repetidos agregarlo a la tabla ahora:
            AddTableRow(arr[i]);
            
          }
          
          //ahora agregar los jugadores con nombre repetido, los cuales fuimos sumando la data que conseguiamos de cada uno
          for(i in repeatedPlayersIndex){
            AddTableRow(repeatedPlayersIndex[i])
          }
          t.draw(false);
      }
    
      function AddTableRow(arr) {
        //Kills per Death
        var kd = 0;
        if (arr.deaths == 0) {
          kd = arr.kills;
        } else {
          kd = (arr.kills/arr.deaths).toFixed(2);
        }
  
        //Accuracy
        var acc = 0;
        if (arr.shots == 0) {
          acc = 0;
        } else {
          acc = (arr.hits/arr.shots).toFixed(2);
        }
  
        //Headshot%
        var hspercent = 0;
        if (arr.hits == 0) {
          hspercent = 0;
        } else {
          hspercent = (arr.hs/arr.hits).toFixed(2);
        }
        if (arr.deaths != 0) { //para limpiar espectadores y repeated players
          t.row.add( [
          i,
          arr.name,
          arr.kills,
          arr.deaths,
          kd,
          arr.dmg,
          arr.shots,
          arr.hits,
          acc,
          arr.hs,
          hspercent,
          arr.tks,
          arr.bDefused,
          arr.bExplosions
        ] );
        }
      }
    </script>
</body>
</html>